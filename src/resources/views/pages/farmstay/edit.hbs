<link rel="stylesheet" href="/css/validate.css">

<style>
.img-test{
    width: 600px;
    height: 400px;
    object-fit: cover;
}
.image-disable{
    opacity: 40%;
    filter: grayscale(100%);
}


.numberstyle-qty {
  position: relative;
  border-radius: 6px;
  background-color: #ffffff;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(116, 116, 116, 0.25);
}

.numberstyle-qty input,
.numberstyle-qty .qty-btn {
  position: relative;
  display: block;
  float: left;
  height: 40px;
  padding: 0;
  margin: 0;
  border: 0px;
  text-align: center;
  line-height: 40px;
  outline: 0;
  box-shadow: 0px;
}

.numberstyle-qty .qty-btn {
  width: 24px;
  font-size: 18px;
  cursor: pointer;
  z-index: 2;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  transition: all 250ms ease;
}

.numberstyle-qty .qty-btn.disabled {
  cursor: default;
  color: rgba(116, 116, 116, 0.5);
}

.numberstyle-qty input {
  width: 24px;
  border-left: 0;
  border-right: 0;
  color: #747474;
  font-size: 16px;
  font-weight: 500;
  z-index: 1;
}

.numberstyle-qty input:focus {
  outline: 0;
  box-shadow: 0px;
}

.numberstyle-qty input[type=number]::-webkit-inner-spin-button,
.numberstyle-qty input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.numberstyle-qty input[type=number] {
  -moz-appearance: textfield;
}


</style>
<div class="mt-4 container">
    
    <div class="row">
        <div class="alert alert-success col-sm-12" role="alert">
            <h4  class="text-center text-success" >Thông tin Farmstay</h4>
        </div>
        <div class="col-sm-6">
            <div class="card w-100">
                <div class="card-header alert alert-primary m-0">
                    <div class="row">
                        <div class="col-sm-10 text-primary">Thông tin chung</div>
                        <div class="col-sm-2 d-flex flex-row-reverse">
                            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#exampleModal">Chỉnh sửa</button>
                        </div>
                        <!-- Modal -->
                        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="formEditInfoFarmstay" method="POST" action="/farmstay/edit/{{farmstay.id}}/edit_info?_method=PUT">
                                        <div class="form-group">
                                            <label for="inputAddress">Tên</label>
                                            <input name="name" value="{{farmstay.name}}"type="text" class="form-control" id="inputEditNameFarmstay" placeholder="Nhập tên farmstay">
                                            <p class="form-message"></p>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                            <label for="inputEmail4">Giá thuê/ngày</label>
                                            <input name="rent_cost" value="{{farmstay.rent_cost_per_day}}" type="text" class="form-control" id="inputEditRentFarmstay" placeholder="Nhập giá thuê">
                                            <p class="form-message"></p>
                                            </div>
                                            <div class="form-group col-md-6">
                                            <label for="inputPassword4">Người quản lý</label>
                                            <select  class="form-control">
                                            </select>
                                            </div>
                                        </div>
                                        
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="submit" form="formEditInfoFarmstay"class="btn btn-primary">Save changes</button>
                                </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">Tên: {{farmstay.name}}</li>
                    <li class="list-group-item">Giá thuê/ngày: <p class="text-dark d-inline money-vnd">{{farmstay.rent_cost_per_day}}</p></li>
                    <li class="list-group-item">Người quản lý: Test</li>
                </ul>
            </div>
            
        </div>
        <div class="col-sm-6">
            <div class="card w-100">
                <div class="card-header alert alert-primary m-0">
                    <div class="row">
                        <div class="col-sm-10 text-primary">Địa chỉ</div>
                        <div class="col-sm-2 d-flex flex-row-reverse">
                            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#exampleModal2">Chỉnh sửa</button>
                        </div>
                        <!-- Modal -->
                        <div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabe2" aria-hidden="true">
                            <div class="modal-dialog  modal-lg" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabe2">Sửa địa chỉ</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="formEditAddressFarmstay" method="POST" action="/farmstay/edit/{{farmstay.id}}/edit_address?_method=PUT">
                                        <div class="form-row">
                                            <div class="form-group col-md-4">
                                                <label for="inputProvince ">Chọn tỉnh</label>
                                                <select id="inputProvince" class="form-control">
                                                <option value="" >Choose...</option>
                                                {{#each provinces}}
                                                    {{#ifEquals ../farmstay.address_of_farmstay.ward.district.province.code this.code}}
                                                        <option value="{{this.code}}" selected>{{this.full_name}}</option>
                                                    {{else}}
                                                        <option value="{{this.code}}">{{this.full_name}}</option>
                                                    {{/ifEquals}}
                                                    
                                                {{/each}}
                                                </select>
                                                

                                                <span class="form-message"></span>
                                            </div>

                                            <div class="form-group col-md-4">
                                                <label for="inputDistrict">Chọn huyện</label>
                                                <select id="inputDistrict" class="form-control">
                                                <option>Choose...</option>
                                                {{#each districts}}
                                                    {{#ifEquals ../farmstay.address_of_farmstay.ward.district.code this.code}}
                                                        <option value="{{this.code}}" selected>{{this.full_name}}</option>
                                                    {{else}}
                                                        <option value="{{this.code}}">{{this.full_name}}</option>
                                                    {{/ifEquals}}
                                                    
                                                {{/each}}
                                                
                                                </select>
                                                
                                                <span class="form-message"></span>
                                            </div>

                                            <div class="form-group col-md-4">
                                                <label for="inputWard">Chọn xã</label>
                                                <select name='ward_code' id="inputWard" class="form-control">
                                                <option>Choose...</option>
                                                {{#each wards}}
                                                    {{#ifEquals ../farmstay.address_of_farmstay.ward.code this.code}}
                                                        <option value="{{this.code}}" selected>{{this.full_name}}</option>
                                                    {{else}}
                                                        <option value="{{this.code}}">{{this.full_name}}</option>
                                                    {{/ifEquals}}
                                                    
                                                {{/each}}
                                                </select>
                                                <span class="form-message"></span>
                                            </div>

                                        </div>
                                        <div class="form-group">
                                            <label for="inputAddress">Địa chỉ cụ thể</label>
                                            <input value="{{farmstay.address_of_farmstay.specific_address}}" type="text" class="form-control" id="inputAddress" name='address' placeholder="Nhập địa chỉ cụ thể">
                                        </div>
                                        <div class="form-group">
                                            <label for="inputLinkGGMAP">Nhập link địa chỉ trên GoogleMap</label>
                                            <input value="{{farmstay.address_of_farmstay.link}}" type="text" class="form-control" id="inputLinkGGMAP" name="link_ggmap">
                                            
                                        </div>
                                        <div class="form-group">
                                            <label for="inputLinkEmbeddedGGMAP">Nhập link nhúng trên GoogleMap</label>
                                            <input value="{{farmstay.address_of_farmstay.embedded_link}}" type="text" class="form-control" id="inputLinkEmbeddedGGMAP" name="link_embedded_ggmap">
                                            
                                        </div>
                                        <div class="form-group">
                                            <a class = "text-primary"href="https://www.google.com/maps" target="_blank">Mở GoogleMap</a>
                                        </div>
                                        
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="submit" form="formEditAddressFarmstay" class="btn btn-primary">Save changes</button>
                                </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <ul class="list-group list-group-flush">
                    {{#with farmstay.address_of_farmstay}}
                        <li class="list-group-item">Địa chỉ: {{ward.full_name}}, {{ward.district.full_name}}, {{ward.district.province.full_name}}</li>
                        <li class="list-group-item">Địa chỉ cụ thể: {{specific_address}}</li>
                        <li class="list-group-item">GoogleMap: <a href="{{link}}" class="text-primary">link</a></li>
                    {{/with}}
                </ul>
            </div>
            
        </div>

        <div class="col-sm-12 mt-4">
            <div class="card w-100">
                <div class="card-header text-primary alert alert-primary m-0">
                    <div class="row">
                        <div class="col-sm-10 text-primary">Danh sách hình ảnh</div>
                        <div class="col-sm-2 d-flex flex-row-reverse">
                            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modalEditImages">Chỉnh sửa</button>
                        </div>
                        <div class="modal fade" id="modalEditImages" tabindex="-1" role="dialog" aria-labelledby="modalEditImagesLabel" aria-hidden="true">
                            <div class="modal-dialog  modal-lg" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="modalEditImagesLabel">Sửa hình ảnh</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <p class="text-dark">Hình ảnh hiện tại</p>
                                            <div class="row text-center text-lg-start">
                                                {{#each farmstay.images}}
                                                    <div class="col-lg-4 col-md-4 col-6 p-2">
                                                        <div class="d-block mb-2 ">
                                                            <img data-id-img="{{this.fileId}}" style="
                                                            width: 120px;
                                                            height: 120px;
                                                            cursor: pointer;
                                                            object-fit: cover;" class="img-fluid img-thumbnail image-list" src="{{this.url}}" alt="">
                                                        </div>
                                                    </div>
                                                {{/each}}
                                                
                                            
                                            </div>
                                        </div>
                                        <div class="col-sm-6 bg-light">
                                            <div class="row">
                                                <div class="col-sm-8">
                                                    <p class="text-dark">Thêm hình ảnh</p>
                                                </div>
                                                <div class="col-sm-4">
                                                    <button id="buttonOpenUpload" type="button" class="btn btn-success btn-sm">Thêm ảnh</button>
                                                </div>
                                            </div>
                                            <div class="row text-center text-lg-start" id="listImageAdd">
                                            </div>
                                        </div>
                                        <div id="msgErrorImage" class="col-sm-12 sr-only"><p class="text-danger font-italic text-center mt-2 mb-0 ">Ảnh quá số lượng cho phép (tối đa 10)</p></div>

                                    </div>

                                    <form id="formEditImageFarmstay" enctype="multipart/form-data" method="POST" action="/farmstay/edit/{{farmstay.id}}/edit_images?_method=PUT">
                                        <input id="inputDeleteImages" value="[]" name="list_img_delete" class="sr-only" type="text">
                                        <input id="inputAddImages" name="farmstay" class="sr-only" accept="image/*" type="file" multiple>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button id="btnDeleteImagesFarmstay" type="button" form="formEditImageFarmstay" class="btn btn-primary">Save changes</button>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        {{#each farmstay.images}}
                            {{#if @first}}
                                <div class="carousel-item active">
                                <img class="d-block w-100 img-test" src="{{this.url}}" alt="First slide">
                                </div>
                            {{else}}
                                <div class="carousel-item">
                                <img class="d-block w-100 img-test" src="{{this.url}}" alt="First slide">
                            </div>
                            {{/if}}
                            
                        {{/each}}
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-sm-12 mt-4">
            <div class="card w-100">
                <div class="card-header text-primary alert alert-primary m-0">
                    <div class="row">
                        <div class="col-sm-10 text-primary">Danh sách thiết bị</div>
                        <div class="col-sm-2 d-flex flex-row-reverse">
                            {{!-- <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#exampleModalLong">Chỉnh sửa</button> --}}
                        </div>
                        <!-- Modal -->
                        <div class="modal fade " id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                            <div class="modal-dialog modal-lg" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLongTitle">Chỉnh sửa thiết bị</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <h6>Thiết bị hiện tại</h6>
                                            <ul class="p-0">
                                                {{#each farmstay.list_equipment}}
                                                    {{#with this.is_equipment}}
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                                            <div class="d-flex align-items-center">
                                                                <img src="{{images.url}}" alt="" style="width: 45px; height: 45px"
                                                                    class="rounded-circle" />
                                                                <div class="ml-3">
                                                                    <p class="fw-bold mb-1 text-dark">{{name}}</p>
                                                                </div>
                                                            
                                                            </div>
                                                            <input data-original-value="{{../quantity_used}}" data-id="{{id}}"class="numberstyle edit-current-equipments-farmstay" type="number" min="0" step="1" value="{{../quantity_used}}" max="{{sum remain ../quantity_used}}">
                                                            
                                                        </li>
                                                    {{/with}}
                                                {{/each}}
                                            </ul>
                                        </div>
                                        <div class="col-sm-12">
                                            <h6>Thiết bị sẵn có</h6>
                                            <ul class="p-0">
                                                {{#each equipments}}
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                                            <div class="d-flex align-items-center">
                                                                <img src="{{this.images.url}}" alt="" style="width: 45px; height: 45px"
                                                                    class="rounded-circle" />
                                                                <div class="ml-3">
                                                                    <p class="fw-bold mb-1 text-dark">{{this.name}}</p>
                                                                </div>
                                                            
                                                            </div>
                                                            <input data-id="{{this.id}}" class="numberstyle add-equipments-farmstay" type="number" min="0" step="1" value="0" max="{{remain}}">
                                                            
                                                        </li>
                                                {{/each}}
                                                
                                            </ul>
                                        </div>
                                    </div>
                                    <form id="formSubmitEditEquipmentsFarmstay"  method="POST" action="/farmstay/edit/{{farmstay.id}}/edit_equipments?_method=PUT">
                                        <input class="sr-only" type="text" name="current_equipments" id="inputEditCurrentEquipments">
                                        <input class="sr-only" type="text" name="add_equipments" id="inputAddCurrentEquipments">
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" id="btnSubmitEditEquipmentsFarmstay" class="btn btn-primary">Save changes</button>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-4">
                    <table id="tableDynamicVerticalScroll" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
                        <thead class="bg-secondary text-white">
                            <tr>
                                <th class="th-sm">Action</th>
                                <th class="th-sm">Image</th>
                                <th class="th-sm">Tên hiển thị</th>
                                <th class="th-sm">Tên thiết bị</th>
                                <th class="th-sm">Khu vực</th>
                                <th class="th-sm">Có dữ liệu</th>
                                <th class="th-sm">Số trường dữ liệu</th>
                                <th class="th-sm">Chi tiết</th>
                                <th class="th-sm">Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each farmstay.list_equipment}}
                                
                                {{#with this.is_equipment}}
                                <tr> 
                                    <td>
                                        <div class="d-flex justify-content-center">
                                            {{!-- <a class="btn btn-sm btn-primary  mr-1"><i class="fa fa-pencil-alt"></i></a> --}}
                                            <span  class="btn btn-sm btn-warning delete-farmstay ml-1">
                                            <i class="fas fa-trash"></i></span>
                                        </div>
                                    </td>
                                    <td class="text-center"><img src="{{images.url}}" alt="" style="width: 45px; height: 45px"class="rounded-circle" /></td>
                                    <td>{{../this.name}}</td>
                                    
                                    <td>{{name}}</td>
                                    <td>{{../this.area.name}}</td>
                                    
                                    
                                    {{#if ../this.have_data}}
                                    <td class="text-center text-success"> <i class="fas fa-check-circle"></i></td>
                                    <td class="text-center">{{../this.number_of_field}}</td>
                                    <td >
                                        <button data-details-equipment={{jsonToString ../this.details}} data-equipment-name="{{../this.name}}" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modalDetailEquipmentFarmstay"><i class="fas fa-info-circle"></i></button>
                                    </td>
                                    {{else}}
                                    <td class="text-center text-danger"> <i class="fas fa-times-circle"></i></td>
                                    <td class="text-center text-danger"> <i class="fas fa-times-circle"></i></td>
                                    <td class="text-center text-danger"> <i class="fas fa-times-circle"></i></td>
                                    {{/if}}
                                    {{#if deletedAt}}
                                        <td class="text-center text-danger">Đã xóa</td>
                                    {{else}}
                                        <td class="text-center text-success">Sẵn sàng</td>
                                    {{/if}}
                                </tr>
                                {{/with}}
                                
                            {{/each}}
                            
                        </tbody>
                        
                    </table>
                </div>
            </div>
        </div>
        <div class="col-sm-12 mt-4">
            <div class="card w-100">
                <div class="card-header text-primary alert alert-primary m-0">
                    <div class="row">
                        <div class="col-sm-10 text-primary">Config</div>
                        {{!-- <div class="col-sm-2 d-flex flex-row-reverse">
                            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#exampleModalLong">Chỉnh sửa</button>
                        </div> --}}
                    </div>
                </div>
                <div class="card-body">
                    <form action="/farmstay/generate_config" method="POST">
                        <input name="id" type="number" class="sr-only" value="{{farmstay.id}}">
                         <button  type="submit" class="btn btn-primary btn-sm">Tạo config</button>
                    </form>
                   
                </div>
                
            </div>
        </div>
    </div>
<div class="modal fade" id="modalDetailEquipmentFarmstay" tabindex="-1" role="dialog" aria-labelledby="modalDetailEquipmentFarmstay" aria-hidden="true">
    <div class="modal-dialog modal-lg  modal-dialog-centered" role="document" style="max-width: 70%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalDetailEquipmentFarmstayLabel">Chi tiết thiết bị farmstay</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table id="tableEquipmentDetails" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
                    <thead class="bg-secondary text-white">
                        <tr style="width: 100%;">
                            <th >#id</th>
                            <th  >Trường dữ liệu</th>
                            <th  >MQTT topic</th>
                        </tr>
                    </thead>
                    
                    
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button id="btnDeleteFarmstay"type="button" class="btn btn-warning">Xóa</button>
            </div>
        </div>
    </div>
</div>
    
</div>
{{> js}}
<script>
    Validator(
    {
        form: '#formEditInfoFarmstay',
        errorSelector: '.form-message',
        formGroupSelector: '.form-group',
        rules:[
            Validator.isRequired('#inputEditNameFarmstay'),
            Validator.isRequired('#inputEditRentFarmstay'),
            

        ],
    }
    );
    Validator(
    {
        form: '#formEditAddressFarmstay',
        errorSelector: '.form-message',
        formGroupSelector: '.form-group',
        rules:[
            Validator.isRequired('#inputProvince'),
            Validator.isRequired('#inputDistrict'),
            Validator.isRequired('#inputWard'),
            

        ],
    }
    );
    $(document).ready(function () {
        var table = $('#tableDynamicVerticalScroll').DataTable({
            "scrollY": "50vh",
            "scrollCollapse": true,
        });
       
    });
    
    
    
</script>
<script src="/js/farmstay/edit_farmstay.js"></script>